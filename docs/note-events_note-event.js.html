<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>note-events/note-event.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="ControllerChangeEvent.html">ControllerChangeEvent</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="CopyrightEvent.html">CopyrightEvent</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="CuePointEvent.html">CuePointEvent</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="EndTrackEvent.html">EndTrackEvent</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="HeaderChunk.html">HeaderChunk</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="InstrumentNameEvent.html">InstrumentNameEvent</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="KeySignatureEvent.html">KeySignatureEvent</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="LyricEvent.html">LyricEvent</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="MarkerEvent.html">MarkerEvent</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="NoteEvent.html">NoteEvent</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="NoteEvent.html#buildData">buildData</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="NoteOffEvent.html">NoteOffEvent</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="NoteOffEvent.html#buildData">buildData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="NoteOffEvent.html#getStatusByte">getStatusByte</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="NoteOnEvent.html">NoteOnEvent</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="NoteOnEvent.html#buildData">buildData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="NoteOnEvent.html#getStatusByte">getStatusByte</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="ProgramChangeEvent.html">ProgramChangeEvent</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="TempoEvent.html">TempoEvent</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="TextEvent.html">TextEvent</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="TimeSignatureEvent.html">TimeSignatureEvent</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Track.html">Track</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Track.html#addCopyright">addCopyright</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Track.html#addCuePoint">addCuePoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Track.html#addEvent">addEvent</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Track.html#addInstrumentName">addInstrumentName</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Track.html#addLyric">addLyric</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Track.html#addMarker">addMarker</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Track.html#addText">addText</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Track.html#addTrackName">addTrackName</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Track.html#buildData">buildData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Track.html#controllerChange">controllerChange</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Track.html#mergeSingleEvent">mergeSingleEvent</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Track.html#mergeTrack">mergeTrack</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Track.html#polyModeOn">polyModeOn</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Track.html#removeEventsByType">removeEventsByType</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Track.html#setKeySignature">setKeySignature</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Track.html#setPitchBend">setPitchBend</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Track.html#setTempo">setTempo</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Track.html#setTimeSignature">setTimeSignature</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="TrackNameEvent.html">TrackNameEvent</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Utils.html">Utils</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Utils.html#.convertVelocity">convertVelocity</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Utils.html#.getDurationMultiplier">getDurationMultiplier</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Utils.html#.getPitch">getPitch</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Utils.html#.getTickDuration">getTickDuration</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Utils.html#.isNumeric">isNumeric</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Utils.html#.numberFromBytes">numberFromBytes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Utils.html#.numberToBytes">numberToBytes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Utils.html#.numberToVariableLength">numberToVariableLength</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Utils.html#.stringByteCount">stringByteCount</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Utils.html#.stringToBytes">stringToBytes</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Utils.html#.toArray">toArray</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Utils.html#.version">version</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Writer.html">Writer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Writer.html#base64">base64</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Writer.html#buildFile">buildFile</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Writer.html#dataUri">dataUri</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Writer.html#saveMIDI">saveMIDI</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Writer.html#stdout">stdout</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#Constants">Constants</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#scale14bits">scale14bits</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">note-events/note-event.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import {Constants} from '../constants';
import {NoteOnEvent} from './note-on-event';
import {NoteOffEvent} from './note-off-event';
import {Utils} from '../utils';

/**
 * Wrapper for noteOnEvent/noteOffEvent objects that builds both events.
 * @param {object} fields - {pitch: '[C4]', duration: '4', wait: '4', velocity: 1-100}
 * @return {NoteEvent}
 */
class NoteEvent {
	constructor(fields) {
		// Set default fields
		fields = Object.assign({
			channel: 1,
			repeat: 1,
			sequential: false,
			startTick: null,
			velocity: 50,
			wait: 0,
		}, fields);

		this.data 		= [];
		this.type 		= 'note';
		this.pitch 		= Utils.toArray(fields.pitch);

		this.channel 	= fields.channel;
		this.duration 	= fields.duration;
		this.grace		= fields.grace;
		this.repeat 	= fields.repeat;
		this.sequential = fields.sequential;
		this.startTick	= fields.startTick;
		this.velocity 	= fields.velocity;
		this.wait 		= fields.wait;

		this.tickDuration = Utils.getTickDuration(this.duration);
		this.restDuration = Utils.getTickDuration(this.wait);

		this.events 	= []; // Hold actual NoteOn/NoteOff events
	}

	/**
	 * Builds int array for this event.
	 * @return {NoteEvent}
	 */
	buildData() {
		// Reset data array
		this.data = [];

		var tickDuration = this.tickDuration;
		var restDuration = this.restDuration;

		// Apply grace note(s) and subtract ticks (currently 1 tick per grace note) from tickDuration so net value is the same
		if (this.grace) {
			let graceDuration = 1;
			this.grace = Utils.toArray(this.grace);
			this.grace.forEach((pitch) => {
				let noteEvent = new NoteEvent({pitch:this.grace, duration:'T' + graceDuration});
				this.data = this.data.concat(noteEvent.data)

				tickDuration -= graceDuration;
			});
		}

		// fields.pitch could be an array of pitches.
		// If so create note events for each and apply the same duration.
		var noteOn, noteOff;
		// By default this is a chord if it's an array of notes that requires one NoteOnEvent.
		// If this.sequential === true then it's a sequential string of notes that requires separate NoteOnEvents.
		if ( ! this.sequential) {
			// Handle repeat
			for (var j = 0; j &lt; this.repeat; j++) {
				// Note on
				this.pitch.forEach((p, i) => {
					if (i == 0) {
						var noteOnNew = new NoteOnEvent({
							channel: this.channel,
							wait: this.wait,
							velocity: this.velocity,
							pitch: p,
							startTick: this.startTick
						});

					} else {
						// Running status (can ommit the note on status)
						//noteOn = new NoteOnEvent({data: [0, Utils.getPitch(p), Utils.convertVelocity(this.velocity)]});
						var noteOnNew = new NoteOnEvent({
							channel: this.channel,
							wait: 0,
							velocity: this.velocity,
							pitch: p,
							startTick: this.startTick
						});
					}

					this.events.push(noteOnNew);
				});

				// Note off
				this.pitch.forEach((p, i) => {
					if (i == 0) {
						//noteOff = new NoteOffEvent({data: Utils.numberToVariableLength(tickDuration).concat(this.getNoteOffStatus(), Utils.getPitch(p), Utils.convertVelocity(this.velocity))});
						var noteOffNew = new NoteOffEvent({
							channel: this.channel,
							duration: this.duration,
							velocity: this.velocity,
							pitch: p,
							tick: this.startTick !== null ? Utils.getTickDuration(this.duration) - this.startTick : null,
						});

					} else {
						// Running status (can ommit the note off status)
						//noteOff = new NoteOffEvent({data: [0, Utils.getPitch(p), Utils.convertVelocity(this.velocity)]});
						var noteOffNew = new NoteOffEvent({
							channel: this.channel,
							duration: 0,
							velocity: this.velocity,
							pitch: p,
							tick: this.startTick !== null ? Utils.getTickDuration(this.duration) - this.startTick : null,
						});
					}

					this.events.push(noteOffNew);
				});
			}

		} else {
			// Handle repeat
			for (var j = 0; j &lt; this.repeat; j++) {
				this.pitch.forEach((p, i) => {
					// restDuration only applies to first note
					if (i > 0) {
						restDuration = 0;
					}

					// If duration is 8th triplets we need to make sure that the total ticks == quarter note.
					// So, the last one will need to be the remainder
					if (this.duration === '8t' &amp;&amp; i == this.pitch.length - 1) {
						let quarterTicks = Utils.numberFromBytes(Constants.HEADER_CHUNK_DIVISION);
						tickDuration = quarterTicks - (tickDuration * 2);
					}

					var noteOnNew = new NoteOnEvent({
						channel: this.channel,
						wait: (i > 0 ? 0 : this.wait), // wait only applies to first note in repetition
						velocity: this.velocity,
						pitch: p,
						startTick: this.startTick,
					});

					var noteOffNew = new NoteOffEvent({
						channel: this.channel,
						duration: this.duration,
						velocity: this.velocity,
						pitch: p,
					});

					this.events.push(noteOnNew, noteOffNew);
				});
			}
		}

		return this;
	}
}

export {NoteEvent};
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Sun May 17 2020 01:25:02 GMT-0700 (Pacific Daylight Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
